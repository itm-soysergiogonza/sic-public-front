<div class="container mx-auto">
  <p-toast position="bottom-center" key="confirm" [baseZIndex]="5000">
    <ng-template let-message pTemplate="message">
      <div class="w-full max-w-md bg-white rounded-lg shadow-lg border-l-4 border-green-500 overflow-hidden animate-fade-in-up">
        <div class="p-4">
          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
              <div class="p-2 rounded-full">
                <i class="bi bi-check-circle text-xl text-green-600"></i>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-lg font-semibold text-gray-900">
                {{ message.summary }}
              </p>
              <p class="mt-1 text-sm text-gray-500">
                {{ message.detail }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </p-toast>

  <div class="max-w-lg mx-auto bg-white rounded-lg shadow-lg p-8">
    <h2 class="text-2xl font-bold mb-8 text-center" style="color: var(--color-primary)">Generar Certificado</h2>

    <div class="mb-8">
      <div class="flex items-center justify-center">
        <div class="flex items-center">
          <div class="w-8 h-8 rounded-full flex items-center justify-center"
               [ngClass]="{'bg-primary text-white': true, 'bg-gray-200 text-gray-500': !selectedCertificateType}">
            <i class="bi bi-1-circle-fill"></i>
          </div>
          <div class="text-sm font-medium ml-2" [ngClass]="{'text-primary': true, 'text-gray-500': !selectedCertificateType}">
            Seleccionar Tipo
          </div>
        </div>
        <div class="w-16 h-1 mx-2" [ngClass]="{'bg-primary': selectedCertificateType, 'bg-gray-200': !selectedCertificateType}"></div>
        <div class="flex items-center">
          <div class="w-8 h-8 rounded-full flex items-center justify-center"
               [ngClass]="{'bg-primary text-white': selectedCertificateType, 'bg-gray-200 text-gray-500': !selectedCertificateType}">
            <i class="bi bi-2-circle-fill"></i>
          </div>
          <div class="text-sm font-medium ml-2" [ngClass]="{'text-primary': selectedCertificateType, 'text-gray-500': !selectedCertificateType}">
            Completar Datos
          </div>
        </div>
      </div>
    </div>

    <form [formGroup]="certificateForm" (ngSubmit)="onSubmit()" class="space-y-8">
      <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
        @if (!isLoading && certificateTypes && certificateTypes.length > 0) {
          <app-select-input
            [options]="certificateTypesOptions"
            [label]="'Tipo de Certificado'"
            [required]="true"
            [clearable]="false"
            [placeholder]="'Seleccione un tipo de certificado'"
            [(ngModel)]="selectedCertificateType"
            [ngModelOptions]="{standalone: true}"
            (selectedChange)="onCertificateTypeChange($event)"
            (opened)="onCertificateTypeSelectOpen()"
            class="w-full">
          </app-select-input>
        }
      </div>

      @if (selectedCertificateType && certificateFields.length > 0) {
        <div
          class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm transition-all duration-300 ease-in-out animate-fadeIn">
          <h3 class="text-lg font-medium mb-4 flex items-center" style="color: var(--color-primary)">
            <i class="bi bi-card-checklist mr-2"></i>
            Datos del Certificado
          </h3>

          <div class="space-y-5">
            @for (field of certificateFields; track field.id) {
              <app-input-field [field]="field" [formGroup]="certificateForm" class="block"></app-input-field>
            }
          </div>
        </div>
      }

      <div class="pt-4">
        <button type="submit"
                [disabled]="!certificateForm.valid || !selectedCertificateType"
                class="w-full py-3 px-4 rounded-md text-white font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center"
                [style.background-color]="'var(--color-primary)'">
          <i class="bi bi-file-earmark-pdf mr-2"></i>
          Generar Certificado
        </button>
      </div>
    </form>
  </div>
</div>

<app-modal-confirm
  [isOpen]="showModal"
  [title]="'Confirmar GeneraciÃ³n'"
  [email]="email"
>
</app-modal-confirm>
